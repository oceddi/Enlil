<html>
   <head>
      <script type="text/javascript" src="../lib/enlil.js"></script>
      <script type="text/javascript" src="../lib/actor.js"></script>
      <script type="text/javascript" src="../lib/sheets.js"></script>
      <script type="text/javascript" src="../lib/path.js"></script>      
      <script type="text/javascript" src="../lib/animator.js"></script>
   </head>
   <body>
   <h1>Paths Test Page</h1>

   <div id='version'></div> 
   <div id='fps'></div> 
   <div id='div1'></div>
   <div id='div2'></div>
   <div id='div3'></div>
   </body>

   <script type="text/javascript">
      var ver   = document.getElementById('version');
      var fps   = document.getElementById('fps');
      var animCount = 0;

      var advance = function() {
         var locations    = Paths.interpolateAll();
         var monIfritId   = Actors.getIdForName('monIfrit');
         var monBahamutId = Actors.getIdForName('monBahamut');
         var circleBatId  = Actors.getIdForName('circleBat');

         Actors.drawGroup(monIfritId,   locations[pathBoxSlow].gid, animCount % 4, locations[pathBoxSlow].x, locations[pathBoxSlow].y);
         Actors.drawGroup(monBahamutId, locations[pathBoxFast].gid, animCount % 4, locations[pathBoxFast].x, locations[pathBoxFast].y);

         if(locations[circleBatId].gid)
            Actors.drawGroup(circleBatId,  locations[pathCircle].gid,  animCount % 4, locations[pathPacing].x+locations[pathCircle].x,  locations[pathPacing].y+locations[pathCircle].y);


         if(Paths.hasStopped(pathPacing))
         {
            if(Paths.hasStopped(pathCircle))
            {
               /* Start a new circle at the end of each waypoint of the pacing path. */
               if(Paths.runCount(pathCircle) == Paths.waypointCount(pathPacing))
               {
                  Paths.reset(pathCircle);
               }
               else /* Finished circle, start the next pacing path waypoint. */
               {
                  Paths.resume(pathPacing);
               }
            }
         }

         Enlil.tick();
         animCount++;
         fps.innerHTML = 'FPS: ' + Enlil.fps;
      };

      Paths.add('box',
      {
         waypoints:
         [
            /*  x, y */
            [   0, 300 ],
            [ 860, 300 ],
            [ 860, 660 ],
            [   0, 660 ]
         ]
      });

      var pathBoxSlow = Paths.instantiate('box',
         {
            automatic: true,
            repeats:   true,
            closeLoop: true,
            reverses:  false,
            curve:     'linear',
            intervals:
            [
               20,
               2,
               16,
               2
            ],
            groups:
            [
               'right',
               'down',
               'left',
               'up'
            ]
         }
      );

      var pathBoxFast = Paths.instantiate('box',
         {
            automatic: true,
            repeats:   true,
            closeLoop: true,
            reverses:  false,
            curve:     'linear',
            intervals:
            [
               10,
               1,
               8,
               1
            ],
            groups:
            [
               'right',
               'down',
               'left',
               'up'
            ]
         }
      );

      /* Do an animation flying in a circle layered on top another one going back and forth. */
      var circlepoints    = [];
      var circleintervals = [];
      var circlegroups    = [];

      for(var i=0; i<360; i+=10)
      {
         var x = Math.cos((i*Math.PI)/180)*100;
         var y = Math.sin((i*Math.PI)/180)*100;
         circlepoints.push( [ x, y ] );
         circleintervals.push(0.1);

         /* Have the animation face outward based on position in circle. */
         if(i < 45 || i >= 315)
         {
            circlegroups.push('right');
         }
         else if(i < 135)
         {
            circlegroups.push('down');
         }
         else if(i < 225)
         {
            circlegroups.push('left');
         }
         else if(i < 315)
         {
            circlegroups.push('up');
         }
      }

      Paths.add('circle',
      {
         waypoints: circlepoints
      });

      Paths.add('pacing',
      {
         waypoints:
         [
            /*  x, y */
            [   0, 300 ],
            [ 400, 300 ],
            [ 860, 300 ]
         ]
      });

      var pathCircle = Paths.instantiate('circle',
         {
            automatic: true,
            repeats:   false,
            closeLoop: true,
            reverses:  false,
            curve:     'linear',
            intervals: circleintervals,
            groups:    circlegroups
         }
      );

      var pathPacing = Paths.instantiate('pacing',
         {
            automatic: false,
            repeats:   true,
            closeLoop: true,
            reverses:  false,
            curve:     'linear',
            intervals: 
            [
               2,
               2,
               2
            ]
         }
      );

      Sheets.add('ifrit',   
      {
         resource:'assets/ifrit.png',
         cwidth:80,
         cheight:80,
         groups:
         {
            'down'  : [  0,  3 ],
            'left'  : [  4,  7 ],
            'right' : [  8, 11 ],
            'up'    : [ 12, 15 ]
         }
      });

      Sheets.add('bahamut',
      {
         resource:'assets/bahamut.png',
         cwidth:96,
         cheight:96,
         groups:
         {
            'down'  : [  0,  3 ],
            'left'  : [  4,  7 ],
            'right' : [  8, 11 ],
            'up'    : [ 12, 15 ]
         }
      });

      Sheets.add('goldbat',
      {
         resource:'assets/goldbat.png',
         cwidth:32,
         cheight:48,
         groups:
         {
            'down'  : [  0,  3 ],
            'left'  : [  4,  7 ],
            'right' : [  8, 11 ],
            'up'    : [ 12, 15 ]
         }
      });

      Actors.add( 
         {
            name : 'monIfrit',
         sheetid : 'ifrit',
             div : 'div1' 
         }
      );

      Actors.add( 
         {
            name : 'monBahamut',
         sheetid : 'bahamut',
             div : 'div2' 
         }
      );

      Actors.add( 
         {
            name : 'circleBat',
         sheetid : 'goldbat',
             div : 'div3' 
         }
      );


      ver.innerHTML = 'Version: ' + Enlil.version; 
      
      window.onload = function() {
         Enlil.startFPS();
         Enlil.registerRunLoop(advance);
         Enlil.start(60);
      }
   </script>
</html>
